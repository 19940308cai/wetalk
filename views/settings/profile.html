{{template "base/base.html" .}}
{{template "base/base_common.html" .}}
{{define "meta"}}<title>{{i18n .Lang "User Profile"}} - {{i18n .Lang .AppName}}</title>{{end}}
{{define "body"}}
<div class="row">
    <div id="content">
        <div class="col-md-3">
        	<div class="box">
        		<div class="cell first breadcrumb">
        		</div>
        		<div class="cell last">
        			<div class="container">
        			</div>
    			</div>
            </div>
    	</div>
        <div class="col-md-9">
            <div class="box">
                <div class="cell first breadcrumb">
                    <a href="{{.AppUrl}}"><i class="icon icon-home"></i></a><i class="divider icon-angle-right"></i><a href="">{{i18n .Lang "User Profile"}}</a>
                </div>
                <div class="cell last slim">
                    {{if .flash.NeedActive}}
                    <div class="alert alert-info">
                        <h4>{{i18n .Lang "Need Active"}}</h4>
                        {{i18n .Lang "To access page, require verify your e-mail."}}
                    </div>
                    {{end}}
                    {{if .flash.RegSuccess}}
                    <div class="alert alert-success">
                        <h4>{{i18n .Lang "Congratulations!"}}</h4>
                        {{i18n .Lang "We have sent a verify e-mail to your mail box, please veify that before you can continue."}}
                    </div>
                    {{end}}
                    {{if .flash.ProfileSave}}
                    <div class="alert alert-success">
                        {{i18n .Lang "Profile success saved."}}
                    </div>
                    {{end}}
                    {{if .flash.PasswordSave}}
                    <div class="alert alert-success">
                        {{i18n .Lang "Password success changed."}}
                    </div>
                    {{end}}
                    <h3 class="underline">Base Profile</h3>
                    <form method="POST" action="{{.AppUrl}}settings/profile">
                        {{.xsrf_html}}{{.once_html}}

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="profile-username">{{i18n .Lang "Username"}}</label>
                                    <input id="profile-username" value="{{.User.UserName}}" type="text" class="form-control" disabled>
                                </div>
                            </div>

                            <div class="col-md-6">
                                {{template "base/form/field_group.html" .ProfileFormSets.Fields.NickName}}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                {{with .ProfileFormSets.Fields.Email}}
                                <div class="form-group{{if .Error}} has-error{{end}}{{if not $.User.IsActive}} has-warning{{end}} {{.Class}}">
                                    {{.Label}}
                                    {{.Field}}
                                    <p class="error-block">
                                        {{if .Error}}{{.Error}}{{else}}
                                            {{if not $.User.IsActive}}{{i18n $.Lang "Please verify your e-mail address."}}{{end}}
                                        {{end}}
                                    </p>
                                    {{if .Help}}<p class="help-block">{{.Help}}</p>{{end}}
                                </div>
                                {{end}}

                                {{template "base/form/field_group.html" .ProfileFormSets.Fields.HideEmail}}

                                {{if .User.IsActive}}{{else}}
                                <div class="form-group">
                                    <button id="verify-mail-send" type="button" data-loading-text="{{i18n .Lang "Sended !"}}" class="btn btn-warning btn-xs">{{i18n .Lang "Send verify email"}}</button>
                                </div>
                                {{end}}
                            </div>

                            <div class="col-md-6">
                                {{template "base/form/field_group.html" .ProfileFormSets.Fields.Url}}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                {{with .ProfileFormSets.Fields.GrEmail}}
                                <div class="form-group{{if .Error}} has-error{{end}} {{.Class}}">
                                    {{.Label}}
                                    <div class="profile-avatar avatar" data-url="{{$.AvatarURL}}">
                                        <img src="{{$.AvatarURL}}{{.Value}}">
                                        <img src="{{$.AvatarURL}}{{.Value}}" class="middle">
                                        <img src="{{$.AvatarURL}}{{.Value}}" class="small">
                                    </div>
                                    {{.Field}}
                                    {{if .Error}}<p class="error-block">{{.Error}}</p>{{end}}
                                    {{if .Help}}<p class="help-block">{{.Help}}</p>{{end}}
                                </div>
                                {{end}}
                            </div>

                            <div class="col-md-6">
                                {{template "base/form/field_group.html" .ProfileFormSets.Fields.Info}}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <input type="hidden" name="action" value="save-profile">
                                    <button type="submit" class="btn btn-primary">{{i18n .Lang "Save Profile"}}&nbsp;&nbsp;<i class="icon-chevron-sign-right"></i></button>
                                </div>
                            </div>
                        </div>
                    </form>

                    <h3 class="underline">Reset Password</h3>
                    <div class="row">
                        <div class="col-md-6">
                            <form method="POST" action="{{.AppUrl}}settings/profile">
                                {{.xsrf_html}}{{.once_html}}

                                {{template "base/form/fields.html" .PasswordFormSets}}

                                <div class="form-group">
                                    <input type="hidden" name="action" value="change-password">
                                    <button type="submit" class="btn btn-primary">{{i18n .Lang "Change password"}}&nbsp;&nbsp;<i class="icon-chevron-sign-right"></i></button>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                </div>
            </div>
        </div>
	</div>
</div>
<script type="text/javascript">
    (function($){
        $(document).on("click", "#verify-mail-send", function(){
            var $btn = $(this);
            $btn.button("loading");
            $.post("{{.AppUrl}}settings/profile", {action:"send-verify-email"}, function(data){
            });
        });
    })(jQuery);
</script>
{{end}}